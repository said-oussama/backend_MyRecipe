"use strict";

var _querystring = _interopRequireDefault(require("querystring"));
var _logger = _interopRequireDefault(require("./logger"));
var _followRedirects = require("follow-redirects");
var _url = require("url");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
class HTTPResponse {
  constructor(response, body) {
    let _text, _data;
    this.status = response.statusCode;
    this.headers = response.headers || {};
    this.cookies = this.headers['set-cookie'];
    if (typeof body == 'string') {
      _text = body;
    } else if (Buffer.isBuffer(body)) {
      this.buffer = body;
    } else if (typeof body == 'object') {
      _data = body;
    }
    const getText = () => {
      if (!_text && this.buffer) {
        _text = this.buffer.toString('utf-8');
      } else if (!_text && _data) {
        _text = JSON.stringify(_data);
      }
      return _text;
    };
    const getData = () => {
      if (!_data) {
        try {
          _data = JSON.parse(getText());
        } catch (e) {
          /* */
        }
      }
      return _data;
    };
    Object.defineProperty(this, 'body', {
      get: () => {
        return body;
      }
    });
    Object.defineProperty(this, 'text', {
      enumerable: true,
      get: getText
    });
    Object.defineProperty(this, 'data', {
      enumerable: true,
      get: getData
    });
  }
}
const clients = {
  'http:': _followRedirects.http,
  'https:': _followRedirects.https
};
function makeCallback(resolve, reject) {
  return function (response) {
    const chunks = [];
    response.on('data', chunk => {
      chunks.push(chunk);
    });
    response.on('end', () => {
      const body = Buffer.concat(chunks);
      const httpResponse = new HTTPResponse(response, body);

      // Consider <200 && >= 400 as errors
      if (httpResponse.status < 200 || httpResponse.status >= 400) {
        return reject(httpResponse);
      } else {
        return resolve(httpResponse);
      }
    });
    response.on('error', reject);
  };
}
const encodeBody = function ({
  body,
  headers = {}
}) {
  if (typeof body !== 'object') {
    return {
      body,
      headers
    };
  }
  var contentTypeKeys = Object.keys(headers).filter(key => {
    return key.match(/content-type/i) != null;
  });
  if (contentTypeKeys.length == 0) {
    // no content type
    //  As per https://parse.com/docs/cloudcode/guide#cloud-code-advanced-sending-a-post-request the default encoding is supposedly x-www-form-urlencoded

    body = _querystring.default.stringify(body);
    headers['Content-Type'] = 'application/x-www-form-urlencoded';
  } else {
    /* istanbul ignore next */
    if (contentTypeKeys.length > 1) {
      _logger.default.error('Parse.Cloud.httpRequest', 'multiple content-type headers are set.');
    }
    // There maybe many, we'll just take the 1st one
    var contentType = contentTypeKeys[0];
    if (headers[contentType].match(/application\/json/i)) {
      body = JSON.stringify(body);
    } else if (headers[contentType].match(/application\/x-www-form-urlencoded/i)) {
      body = _querystring.default.stringify(body);
    }
  }
  return {
    body,
    headers
  };
};
function httpRequest(options) {
  let url;
  try {
    url = (0, _url.parse)(options.url);
  } catch (e) {
    return Promise.reject(e);
  }
  options = Object.assign(options, encodeBody(options));
  // support params options
  if (typeof options.params === 'object') {
    options.qs = options.params;
  } else if (typeof options.params === 'string') {
    options.qs = _querystring.default.parse(options.params);
  }
  const client = clients[url.protocol];
  if (!client) {
    return Promise.reject(`Unsupported protocol ${url.protocol}`);
  }
  const requestOptions = {
    method: options.method,
    port: Number(url.port),
    path: url.pathname,
    hostname: url.hostname,
    headers: options.headers,
    encoding: null,
    followRedirects: options.followRedirects === true
  };
  if (requestOptions.headers) {
    Object.keys(requestOptions.headers).forEach(key => {
      if (typeof requestOptions.headers[key] === 'undefined') {
        delete requestOptions.headers[key];
      }
    });
  }
  if (url.search) {
    options.qs = Object.assign({}, options.qs, _querystring.default.parse(url.query));
  }
  if (url.auth) {
    requestOptions.auth = url.auth;
  }
  if (options.qs) {
    requestOptions.path += `?${_querystring.default.stringify(options.qs)}`;
  }
  if (options.agent) {
    requestOptions.agent = options.agent;
  }
  return new Promise((resolve, reject) => {
    const req = client.request(requestOptions, makeCallback(resolve, reject, options));
    if (options.body) {
      req.write(options.body);
    }
    req.on('error', error => {
      reject(error);
    });
    req.end();
  });
}
module.exports = httpRequest;
module.exports.encodeBody = encodeBody;
module.exports.HTTPResponse = HTTPResponse;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJIVFRQUmVzcG9uc2UiLCJjb25zdHJ1Y3RvciIsInJlc3BvbnNlIiwiYm9keSIsIl90ZXh0IiwiX2RhdGEiLCJzdGF0dXMiLCJzdGF0dXNDb2RlIiwiaGVhZGVycyIsImNvb2tpZXMiLCJCdWZmZXIiLCJpc0J1ZmZlciIsImJ1ZmZlciIsImdldFRleHQiLCJ0b1N0cmluZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXREYXRhIiwicGFyc2UiLCJlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXQiLCJlbnVtZXJhYmxlIiwiY2xpZW50cyIsImh0dHAiLCJodHRwcyIsIm1ha2VDYWxsYmFjayIsInJlc29sdmUiLCJyZWplY3QiLCJjaHVua3MiLCJvbiIsImNodW5rIiwicHVzaCIsImNvbmNhdCIsImh0dHBSZXNwb25zZSIsImVuY29kZUJvZHkiLCJjb250ZW50VHlwZUtleXMiLCJrZXlzIiwiZmlsdGVyIiwia2V5IiwibWF0Y2giLCJsZW5ndGgiLCJxdWVyeXN0cmluZyIsImxvZyIsImVycm9yIiwiY29udGVudFR5cGUiLCJodHRwUmVxdWVzdCIsIm9wdGlvbnMiLCJ1cmwiLCJQcm9taXNlIiwiYXNzaWduIiwicGFyYW1zIiwicXMiLCJjbGllbnQiLCJwcm90b2NvbCIsInJlcXVlc3RPcHRpb25zIiwibWV0aG9kIiwicG9ydCIsIk51bWJlciIsInBhdGgiLCJwYXRobmFtZSIsImhvc3RuYW1lIiwiZW5jb2RpbmciLCJmb2xsb3dSZWRpcmVjdHMiLCJmb3JFYWNoIiwic2VhcmNoIiwicXVlcnkiLCJhdXRoIiwiYWdlbnQiLCJyZXEiLCJyZXF1ZXN0Iiwid3JpdGUiLCJlbmQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vc3JjL3JlcXVlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHF1ZXJ5c3RyaW5nIGZyb20gJ3F1ZXJ5c3RyaW5nJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgaHR0cCwgaHR0cHMgfSBmcm9tICdmb2xsb3ctcmVkaXJlY3RzJztcbmltcG9ydCB7IHBhcnNlIH0gZnJvbSAndXJsJztcblxuY2xhc3MgSFRUUFJlc3BvbnNlIHtcbiAgY29uc3RydWN0b3IocmVzcG9uc2UsIGJvZHkpIHtcbiAgICBsZXQgX3RleHQsIF9kYXRhO1xuICAgIHRoaXMuc3RhdHVzID0gcmVzcG9uc2Uuc3RhdHVzQ29kZTtcbiAgICB0aGlzLmhlYWRlcnMgPSByZXNwb25zZS5oZWFkZXJzIHx8IHt9O1xuICAgIHRoaXMuY29va2llcyA9IHRoaXMuaGVhZGVyc1snc2V0LWNvb2tpZSddO1xuXG4gICAgaWYgKHR5cGVvZiBib2R5ID09ICdzdHJpbmcnKSB7XG4gICAgICBfdGV4dCA9IGJvZHk7XG4gICAgfSBlbHNlIGlmIChCdWZmZXIuaXNCdWZmZXIoYm9keSkpIHtcbiAgICAgIHRoaXMuYnVmZmVyID0gYm9keTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBib2R5ID09ICdvYmplY3QnKSB7XG4gICAgICBfZGF0YSA9IGJvZHk7XG4gICAgfVxuXG4gICAgY29uc3QgZ2V0VGV4dCA9ICgpID0+IHtcbiAgICAgIGlmICghX3RleHQgJiYgdGhpcy5idWZmZXIpIHtcbiAgICAgICAgX3RleHQgPSB0aGlzLmJ1ZmZlci50b1N0cmluZygndXRmLTgnKTtcbiAgICAgIH0gZWxzZSBpZiAoIV90ZXh0ICYmIF9kYXRhKSB7XG4gICAgICAgIF90ZXh0ID0gSlNPTi5zdHJpbmdpZnkoX2RhdGEpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIF90ZXh0O1xuICAgIH07XG5cbiAgICBjb25zdCBnZXREYXRhID0gKCkgPT4ge1xuICAgICAgaWYgKCFfZGF0YSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIF9kYXRhID0gSlNPTi5wYXJzZShnZXRUZXh0KCkpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgLyogKi9cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIF9kYXRhO1xuICAgIH07XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2JvZHknLCB7XG4gICAgICBnZXQ6ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGJvZHk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICd0ZXh0Jywge1xuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGdldDogZ2V0VGV4dCxcbiAgICB9KTtcblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnZGF0YScsIHtcbiAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICBnZXQ6IGdldERhdGEsXG4gICAgfSk7XG4gIH1cbn1cblxuY29uc3QgY2xpZW50cyA9IHtcbiAgJ2h0dHA6JzogaHR0cCxcbiAgJ2h0dHBzOic6IGh0dHBzLFxufTtcblxuZnVuY3Rpb24gbWFrZUNhbGxiYWNrKHJlc29sdmUsIHJlamVjdCkge1xuICByZXR1cm4gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgY29uc3QgY2h1bmtzID0gW107XG4gICAgcmVzcG9uc2Uub24oJ2RhdGEnLCBjaHVuayA9PiB7XG4gICAgICBjaHVua3MucHVzaChjaHVuayk7XG4gICAgfSk7XG4gICAgcmVzcG9uc2Uub24oJ2VuZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGJvZHkgPSBCdWZmZXIuY29uY2F0KGNodW5rcyk7XG4gICAgICBjb25zdCBodHRwUmVzcG9uc2UgPSBuZXcgSFRUUFJlc3BvbnNlKHJlc3BvbnNlLCBib2R5KTtcblxuICAgICAgLy8gQ29uc2lkZXIgPDIwMCAmJiA+PSA0MDAgYXMgZXJyb3JzXG4gICAgICBpZiAoaHR0cFJlc3BvbnNlLnN0YXR1cyA8IDIwMCB8fCBodHRwUmVzcG9uc2Uuc3RhdHVzID49IDQwMCkge1xuICAgICAgICByZXR1cm4gcmVqZWN0KGh0dHBSZXNwb25zZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcmVzb2x2ZShodHRwUmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJlc3BvbnNlLm9uKCdlcnJvcicsIHJlamVjdCk7XG4gIH07XG59XG5cbmNvbnN0IGVuY29kZUJvZHkgPSBmdW5jdGlvbiAoeyBib2R5LCBoZWFkZXJzID0ge30gfSkge1xuICBpZiAodHlwZW9mIGJvZHkgIT09ICdvYmplY3QnKSB7XG4gICAgcmV0dXJuIHsgYm9keSwgaGVhZGVycyB9O1xuICB9XG4gIHZhciBjb250ZW50VHlwZUtleXMgPSBPYmplY3Qua2V5cyhoZWFkZXJzKS5maWx0ZXIoa2V5ID0+IHtcbiAgICByZXR1cm4ga2V5Lm1hdGNoKC9jb250ZW50LXR5cGUvaSkgIT0gbnVsbDtcbiAgfSk7XG5cbiAgaWYgKGNvbnRlbnRUeXBlS2V5cy5sZW5ndGggPT0gMCkge1xuICAgIC8vIG5vIGNvbnRlbnQgdHlwZVxuICAgIC8vICBBcyBwZXIgaHR0cHM6Ly9wYXJzZS5jb20vZG9jcy9jbG91ZGNvZGUvZ3VpZGUjY2xvdWQtY29kZS1hZHZhbmNlZC1zZW5kaW5nLWEtcG9zdC1yZXF1ZXN0IHRoZSBkZWZhdWx0IGVuY29kaW5nIGlzIHN1cHBvc2VkbHkgeC13d3ctZm9ybS11cmxlbmNvZGVkXG5cbiAgICBib2R5ID0gcXVlcnlzdHJpbmcuc3RyaW5naWZ5KGJvZHkpO1xuICAgIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7XG4gIH0gZWxzZSB7XG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICBpZiAoY29udGVudFR5cGVLZXlzLmxlbmd0aCA+IDEpIHtcbiAgICAgIGxvZy5lcnJvcignUGFyc2UuQ2xvdWQuaHR0cFJlcXVlc3QnLCAnbXVsdGlwbGUgY29udGVudC10eXBlIGhlYWRlcnMgYXJlIHNldC4nKTtcbiAgICB9XG4gICAgLy8gVGhlcmUgbWF5YmUgbWFueSwgd2UnbGwganVzdCB0YWtlIHRoZSAxc3Qgb25lXG4gICAgdmFyIGNvbnRlbnRUeXBlID0gY29udGVudFR5cGVLZXlzWzBdO1xuICAgIGlmIChoZWFkZXJzW2NvbnRlbnRUeXBlXS5tYXRjaCgvYXBwbGljYXRpb25cXC9qc29uL2kpKSB7XG4gICAgICBib2R5ID0gSlNPTi5zdHJpbmdpZnkoYm9keSk7XG4gICAgfSBlbHNlIGlmIChoZWFkZXJzW2NvbnRlbnRUeXBlXS5tYXRjaCgvYXBwbGljYXRpb25cXC94LXd3dy1mb3JtLXVybGVuY29kZWQvaSkpIHtcbiAgICAgIGJvZHkgPSBxdWVyeXN0cmluZy5zdHJpbmdpZnkoYm9keSk7XG4gICAgfVxuICB9XG4gIHJldHVybiB7IGJvZHksIGhlYWRlcnMgfTtcbn07XG5cbmZ1bmN0aW9uIGh0dHBSZXF1ZXN0KG9wdGlvbnMpIHtcbiAgbGV0IHVybDtcbiAgdHJ5IHtcbiAgICB1cmwgPSBwYXJzZShvcHRpb25zLnVybCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZSk7XG4gIH1cbiAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24ob3B0aW9ucywgZW5jb2RlQm9keShvcHRpb25zKSk7XG4gIC8vIHN1cHBvcnQgcGFyYW1zIG9wdGlvbnNcbiAgaWYgKHR5cGVvZiBvcHRpb25zLnBhcmFtcyA9PT0gJ29iamVjdCcpIHtcbiAgICBvcHRpb25zLnFzID0gb3B0aW9ucy5wYXJhbXM7XG4gIH0gZWxzZSBpZiAodHlwZW9mIG9wdGlvbnMucGFyYW1zID09PSAnc3RyaW5nJykge1xuICAgIG9wdGlvbnMucXMgPSBxdWVyeXN0cmluZy5wYXJzZShvcHRpb25zLnBhcmFtcyk7XG4gIH1cbiAgY29uc3QgY2xpZW50ID0gY2xpZW50c1t1cmwucHJvdG9jb2xdO1xuICBpZiAoIWNsaWVudCkge1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgVW5zdXBwb3J0ZWQgcHJvdG9jb2wgJHt1cmwucHJvdG9jb2x9YCk7XG4gIH1cbiAgY29uc3QgcmVxdWVzdE9wdGlvbnMgPSB7XG4gICAgbWV0aG9kOiBvcHRpb25zLm1ldGhvZCxcbiAgICBwb3J0OiBOdW1iZXIodXJsLnBvcnQpLFxuICAgIHBhdGg6IHVybC5wYXRobmFtZSxcbiAgICBob3N0bmFtZTogdXJsLmhvc3RuYW1lLFxuICAgIGhlYWRlcnM6IG9wdGlvbnMuaGVhZGVycyxcbiAgICBlbmNvZGluZzogbnVsbCxcbiAgICBmb2xsb3dSZWRpcmVjdHM6IG9wdGlvbnMuZm9sbG93UmVkaXJlY3RzID09PSB0cnVlLFxuICB9O1xuICBpZiAocmVxdWVzdE9wdGlvbnMuaGVhZGVycykge1xuICAgIE9iamVjdC5rZXlzKHJlcXVlc3RPcHRpb25zLmhlYWRlcnMpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIGlmICh0eXBlb2YgcmVxdWVzdE9wdGlvbnMuaGVhZGVyc1trZXldID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICBkZWxldGUgcmVxdWVzdE9wdGlvbnMuaGVhZGVyc1trZXldO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGlmICh1cmwuc2VhcmNoKSB7XG4gICAgb3B0aW9ucy5xcyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMucXMsIHF1ZXJ5c3RyaW5nLnBhcnNlKHVybC5xdWVyeSkpO1xuICB9XG4gIGlmICh1cmwuYXV0aCkge1xuICAgIHJlcXVlc3RPcHRpb25zLmF1dGggPSB1cmwuYXV0aDtcbiAgfVxuICBpZiAob3B0aW9ucy5xcykge1xuICAgIHJlcXVlc3RPcHRpb25zLnBhdGggKz0gYD8ke3F1ZXJ5c3RyaW5nLnN0cmluZ2lmeShvcHRpb25zLnFzKX1gO1xuICB9XG4gIGlmIChvcHRpb25zLmFnZW50KSB7XG4gICAgcmVxdWVzdE9wdGlvbnMuYWdlbnQgPSBvcHRpb25zLmFnZW50O1xuICB9XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgcmVxID0gY2xpZW50LnJlcXVlc3QocmVxdWVzdE9wdGlvbnMsIG1ha2VDYWxsYmFjayhyZXNvbHZlLCByZWplY3QsIG9wdGlvbnMpKTtcbiAgICBpZiAob3B0aW9ucy5ib2R5KSB7XG4gICAgICByZXEud3JpdGUob3B0aW9ucy5ib2R5KTtcbiAgICB9XG4gICAgcmVxLm9uKCdlcnJvcicsIGVycm9yID0+IHtcbiAgICAgIHJlamVjdChlcnJvcik7XG4gICAgfSk7XG4gICAgcmVxLmVuZCgpO1xuICB9KTtcbn1cbm1vZHVsZS5leHBvcnRzID0gaHR0cFJlcXVlc3Q7XG5tb2R1bGUuZXhwb3J0cy5lbmNvZGVCb2R5ID0gZW5jb2RlQm9keTtcbm1vZHVsZS5leHBvcnRzLkhUVFBSZXNwb25zZSA9IEhUVFBSZXNwb25zZTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUE0QjtBQUU1QixNQUFNQSxZQUFZLENBQUM7RUFDakJDLFdBQVcsQ0FBQ0MsUUFBUSxFQUFFQyxJQUFJLEVBQUU7SUFDMUIsSUFBSUMsS0FBSyxFQUFFQyxLQUFLO0lBQ2hCLElBQUksQ0FBQ0MsTUFBTSxHQUFHSixRQUFRLENBQUNLLFVBQVU7SUFDakMsSUFBSSxDQUFDQyxPQUFPLEdBQUdOLFFBQVEsQ0FBQ00sT0FBTyxJQUFJLENBQUMsQ0FBQztJQUNyQyxJQUFJLENBQUNDLE9BQU8sR0FBRyxJQUFJLENBQUNELE9BQU8sQ0FBQyxZQUFZLENBQUM7SUFFekMsSUFBSSxPQUFPTCxJQUFJLElBQUksUUFBUSxFQUFFO01BQzNCQyxLQUFLLEdBQUdELElBQUk7SUFDZCxDQUFDLE1BQU0sSUFBSU8sTUFBTSxDQUFDQyxRQUFRLENBQUNSLElBQUksQ0FBQyxFQUFFO01BQ2hDLElBQUksQ0FBQ1MsTUFBTSxHQUFHVCxJQUFJO0lBQ3BCLENBQUMsTUFBTSxJQUFJLE9BQU9BLElBQUksSUFBSSxRQUFRLEVBQUU7TUFDbENFLEtBQUssR0FBR0YsSUFBSTtJQUNkO0lBRUEsTUFBTVUsT0FBTyxHQUFHLE1BQU07TUFDcEIsSUFBSSxDQUFDVCxLQUFLLElBQUksSUFBSSxDQUFDUSxNQUFNLEVBQUU7UUFDekJSLEtBQUssR0FBRyxJQUFJLENBQUNRLE1BQU0sQ0FBQ0UsUUFBUSxDQUFDLE9BQU8sQ0FBQztNQUN2QyxD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